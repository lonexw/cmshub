(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c49078ba"],{"073f":function(e,t,a){},"28e9":function(e,t,a){"use strict";var i=a("073f"),n=a.n(i);n.a},"34d6":function(e,t){var a={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"userAssets"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"paginator"}},type:{kind:"NamedType",name:{kind:"Name",value:"PaginatorInput"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"more"}},type:{kind:"NamedType",name:{kind:"Name",value:"AssetPaginatorInput"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userAssets"},arguments:[{kind:"Argument",name:{kind:"Name",value:"paginator"},value:{kind:"Variable",name:{kind:"Name",value:"paginator"}}},{kind:"Argument",name:{kind:"Name",value:"more"},value:{kind:"Variable",name:{kind:"Name",value:"more"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"items"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"file_size"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created_at"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updated_at"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"cursor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"total"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"userCreateBatchAsset"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AssetInput"}}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userCreateBatchAsset"},arguments:[{kind:"Argument",name:{kind:"Name",value:"data"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"userDeleteBatchAsset"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"ids"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userDeleteBatchAsset"},arguments:[{kind:"Argument",name:{kind:"Name",value:"ids"},value:{kind:"Variable",name:{kind:"Name",value:"ids"}}}],directives:[]}]}}],loc:{start:0,end:460}};a.loc.source={body:"query userAssets($paginator: PaginatorInput\n  $more: AssetPaginatorInput) {\n  userAssets(paginator: $paginator\n    more: $more) {\n    items {\n      id,\n      name,\n      url,\n      file_size,\n      type,\n      created_at,\n      updated_at\n    },\n    cursor {\n      total\n    }\n  }\n}\n\nmutation userCreateBatchAsset($data: [AssetInput!]!) {\n  userCreateBatchAsset(data: $data)\n}\n\nmutation userDeleteBatchAsset($ids: [Int]!) {\n  userDeleteBatchAsset(ids: $ids)\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var a=e.type;"NamedType"===a.kind&&t.add(a.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var a=0;a<e.definitions.length;a++){var i=e.definitions[a];if(i.name&&i.name.value==t)return i}}function o(e,t){var a={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(a.loc=e.loc);var i=n[t]||new Set,o=new Set,r=new Set;i.forEach((function(e){r.add(e)}));while(r.size>0){var c=r;r=new Set,c.forEach((function(e){if(!o.has(e)){o.add(e);var t=n[e]||new Set;t.forEach((function(e){r.add(e)}))}}))}return o.forEach((function(t){var i=s(e,t);i&&a.definitions.push(i)})),a}(function(){a.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}}))})(),e.exports=a,e.exports["userAssets"]=o(a,"userAssets"),e.exports["userCreateBatchAsset"]=o(a,"userCreateBatchAsset"),e.exports["userDeleteBatchAsset"]=o(a,"userDeleteBatchAsset")},4298:function(e,t,a){},6616:function(e,t,a){"use strict";var i=a("ae25"),n=a.n(i);n.a},ae25:function(e,t,a){},b8c2:function(e,t,a){},c9f8:function(e,t,a){"use strict";var i=a("4298"),n=a.n(i);n.a},ee27:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.show_list?a("assets",{on:{batchAdd:e.showBatch,update:e.update}}):e._e(),e.show_create?a("asset-create",{on:{cancel:e.cancelUpdate,ok:e.ok}}):e._e(),e.show_batch?a("asset-create-batch",{on:{cancel:e.cancelBatch,ok:e.ok}}):e._e()],1)},n=[],s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"relative"},[a("header",{staticClass:"padding-lr-sm padding-tb-xs flex align-center justify-between solid-bottom line-grey"},[a("bg-tag",{attrs:{active:!0}},[e._v("附件管理")]),a("div",[a("a-button",{attrs:{type:"primary"},on:{click:e.add}},[a("a-icon",{attrs:{type:"plus"}}),e._v("新增 ")],1),a("span"),a("a-button",{attrs:{type:"primary"},on:{click:e.batchAdd}},[a("a-icon",{attrs:{type:"plus"}}),e._v("批量上传 ")],1)],1)],1),a("div",{staticClass:"flex align-center padding-lr-sm solid-bottom line-grey",staticStyle:{height:"36px"}},[a("span",{staticClass:"margin-right-sm"},[e._v(e._s(e.select_num)+" 选中")]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.select_num>0,expression:"select_num > 0"}],staticClass:"flex",on:{click:e.batchDelete}},[a("bg-tag",{staticClass:"text-red"},[a("a-icon",{staticClass:"margin-right-xxs",attrs:{type:"delete"}}),e._v(" 删除 ")],1)],1)]),a("div",{staticClass:"flex justify-center margin-top-sm"},[a("a-pagination",{attrs:{showSizeChanger:"",showQuickJumper:"",total:e.total,showTotal:function(e){return"共 "+e+" 条"},pageSize:e.search.paginator.limit,defaultCurrent:1,pageSizeOptions:["10","30","50","100"]},on:{change:e.change,showSizeChange:e.showSizeChange}})],1),a("a-table",{attrs:{size:"middle",rowKey:"id",rowSelection:e.rowSelection,columns:e.columns,dataSource:e.data,pagination:!1,scroll:{x:1200,y:"calc(100vh - 210px)",scrollToFirstRowOnChange:!0}},scopedSlots:e._u([{key:"url",fn:function(t,i){return[i.type.indexOf("image")>-1?a("preview-image",{attrs:{src:t,height:"30px"}}):a("span",[e._v(e._s(t))])]}}])})],1)},o=[],r=(a("4160"),a("ac1f"),a("841c"),a("159b"),a("2af9")),c=a("34d6"),l=a("ca00"),d=a("4360"),u=a("a3be"),m=a("4c87"),h={name:"Contents",props:{},components:{BgTag:r["d"],PreviewImage:m["a"]},data:function(){var e=this,t=[{title:"文件名",dataIndex:"name",scopedSlots:{customRender:"name"}},{title:"预览",dataIndex:"url",scopedSlots:{customRender:"url"}},{title:"大小",dataIndex:"file_size"},{title:"上传时间",dataIndex:"created_at"}],a={onChange:function(t,a){e.select_num=a.length;var i=[];a.forEach((function(e){i.push(e.id)})),e.ids=i}};return{rowSelection:a,columns:t,data:[],select_num:0,ids:[],show_create:!1,total:30,search:{paginator:{page:1,limit:30}}}},computed:{},mounted:function(){this.getList()},methods:{add:function(){this.$emit("update")},batchAdd:function(){this.$emit("batchAdd")},showSizeChange:function(e,t){this.search.paginator.limit=t,this.getList()},change:function(e,t){this.search.paginator.page=e,this.search.paginator.limit=t,this.getList()},getList:function(){var e=this,t=this;t.$apollo.query({query:c["userAssets"],variables:t.search,fetchPolicy:"no-cache",context:{uri:u["a"].projectUri+d["a"].state.common.currentProject.id}}).then((function(e){t.data=e.data.userAssets.items,t.total=e.data.userAssets.cursor.total})).catch((function(t){e.$message.warning(Object(l["a"])(t.message))}))},batchDelete:function(){var e=this;this.$confirm({title:"确认删除选中数据吗？",confirmLoading:!0,onOk:function(){e.$apollo.mutate({mutation:c["userDeleteBatchAsset"],variables:{ids:e.ids},fetchPolicy:"no-cache",context:{uri:u["a"].projectUri+d["a"].state.common.currentProject.id}}).then((function(){e.$message.success("删除成功"),e.getList(),e.select_num=0,e.ids=[]})).catch((function(t){e.$message.warning(Object(l["a"])(t.message))}))}})}}},f=h,p=(a("28e9"),a("c9f8"),a("2877")),g=Object(p["a"])(f,s,o,!1,null,"ff561e10",null),v=g.exports,k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-layout",{staticStyle:{"background-color":"white","margin-right":"240px"}},[a("a-layout-header",{staticClass:"header light",staticStyle:{height:"50px","line-height":"50px"}},[a("div",{staticClass:"flex align-center padding-lr-sm text-bold pointer text-black",on:{click:e.cancel}},[a("a-icon",{staticClass:"margin-right-xs",attrs:{type:"left"}}),e._v(" 新建附件 ")],1)]),a("a-layout-content",[a("div",{staticClass:"content-body padding-lr-sm"},[a("a-form-model",{ref:"form",attrs:{layout:"vertical",model:e.form}},[a("a-form-model-item",{attrs:{label:"上传",prop:"url"}},[a("area-upload",{attrs:{data:{id:1}},on:{change:e.handleChange}})],1)],1)],1)]),a("div",{staticClass:"flex justify-center margin-top"},[a("a-button",{staticClass:"margin-right",attrs:{type:"link",loading:e.submit_loading},on:{click:e.cancel}},[e._v("取消")]),a("a-button",{attrs:{type:"primary",loading:e.submit_loading},on:{click:e.handleUpload}},[e._v("创建")])],1)],1)],1)},b=[],y=(a("b0c0"),{components:{AreaUpload:r["a"]},data:function(){return{fileList:[],form:this.$form.createForm(this),submit_loading:!1}},created:function(){},methods:{cancel:function(){this.$emit("cancel")},goSchema:function(){this.$router.push({name:"Schema"})},handleChange:function(e){this.fileList=[e]},handleUpload:function(e){var t=this;e.preventDefault();var a=this;if(0!=this.fileList.length){var i=[];this.fileList.forEach((function(e){i.push({name:e.name,url:e.url,type:e.mime,file_size:e.size,is_system:"false"})})),a.$apollo.mutate({mutation:c["userCreateBatchAsset"],variables:{data:i},fetchPolicy:"no-cache",context:{uri:u["a"].projectUri+d["a"].state.common.currentProject.id}}).then((function(){t.$emit("ok")})).catch((function(e){t.$message.warning(Object(l["a"])(e.message))}))}else this.$message.warning("请上传文件")}}}),_=y,w=(a("6616"),Object(p["a"])(_,k,b,!1,null,"69f268d4",null)),S=w.exports,x=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-layout",{staticStyle:{"background-color":"white","margin-right":"240px"}},[a("a-layout-header",{staticClass:"header light",staticStyle:{height:"50px","line-height":"50px"}},[a("div",{staticClass:"flex align-center padding-lr-sm text-bold pointer text-black",on:{click:e.cancel}},[a("a-icon",{staticClass:"margin-right-xs",attrs:{type:"left"}}),e._v(" 批量新建附件 ")],1)]),a("a-layout-content",[a("div",{staticClass:"content-body padding-lr-sm"},[a("a-form-model",{ref:"form",attrs:{layout:"vertical",model:e.form}},[a("a-form-model-item",{attrs:{label:"上传",prop:"url"}},[a("batch-upload",{attrs:{data:{id:1}},on:{change:e.handleChange}})],1)],1)],1)]),a("div",{staticClass:"flex justify-center margin-top"},[a("a-button",{staticClass:"margin-right",attrs:{type:"link",loading:e.submit_loading},on:{click:e.cancel}},[e._v("取消")]),a("a-button",{attrs:{type:"primary",loading:e.submit_loading},on:{click:e.handleUpload}},[e._v("创建")])],1)],1)],1)},N=[],C={components:{BatchUpload:r["c"]},data:function(){return{fileList:[],form:this.$form.createForm(this),submit_loading:!1}},created:function(){},methods:{cancel:function(){this.$emit("cancel")},goSchema:function(){this.$router.push({name:"Schema"})},handleChange:function(e){this.fileList=e},handleUpload:function(e){var t=this;e.preventDefault();var a=this;if(0!=this.fileList.length){var i=[];this.fileList.forEach((function(e){i.push({name:e.name,url:e.url,type:e.mime,file_size:e.size,is_system:"false"})})),a.$apollo.mutate({mutation:c["userCreateBatchAsset"],variables:{data:i},fetchPolicy:"no-cache",context:{uri:u["a"].projectUri+d["a"].state.common.currentProject.id}}).then((function(){a.$emit("ok")})).catch((function(e){t.$message.warning(Object(l["a"])(e.message))}))}else this.$message.warning("请上传文件")}}},A=C,$=(a("f7c4"),Object(p["a"])(A,x,N,!1,null,"e3befbac",null)),D=$.exports,B={components:{Assets:v,AssetCreate:S,AssetCreateBatch:D},data:function(){return{content:{id:1},show_list:!0,show_create:!1,show_batch:!1}},computed:{},mounted:function(){},methods:{cancelUpdate:function(){this.show_list=!0,this.show_create=!1},cancelBatch:function(){this.show_batch=!1,this.show_create=!1,this.show_list=!0},showBatch:function(){this.show_batch=!0,this.show_list=!1,this.show_create=!1},ok:function(){this.show_list=!0,this.show_batch=!1,this.show_create=!1},update:function(e){this.content=e||{},this.show_create=!0,this.show_list=!1,this.show_batch=!1}}},j=B,F=Object(p["a"])(j,i,n,!1,null,"45c3ae18",null);t["default"]=F.exports},f7c4:function(e,t,a){"use strict";var i=a("b8c2"),n=a.n(i);n.a}}]);
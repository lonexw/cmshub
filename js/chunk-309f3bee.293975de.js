(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-309f3bee"],{"06d7":function(e,t,i){"use strict";var a=i("fb59"),n=i.n(a);n.a},"21b3":function(e,t){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"userCategories"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userCategories"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"items"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"userCategoryList"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userCategories"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"items"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"customs"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"zh_name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"plural_name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"category_id"},arguments:[],directives:[]}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"userCategory"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userCategory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"userCreateCategory"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CategoryInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userCreateCategory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"data"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"userUpdateCategory"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CategoryInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userUpdateCategory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"data"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"userUpdateSequenceCategory"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"CategorySequenceInput"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userUpdateSequenceCategory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"data"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[]}]}}],loc:{start:0,end:730}};i.loc.source={body:"query userCategories {\n  userCategories {\n    items {\n      id,\n      title\n    }\n  }\n}\n\nquery userCategoryList {\n  userCategories {\n    items {\n      id\n      title\n      customs {\n        id\n        name\n        zh_name\n        plural_name\n        description\n        category_id\n      }\n    }\n  }\n}\n\nquery userCategory ($id: Int!) {\n  userCategory (id: $id) {\n    id\n    title\n  }\n}\n\nmutation userCreateCategory($data: CategoryInput!) {\n  userCreateCategory(data: $data) {\n    id,\n    title\n  }\n}\n\nmutation userUpdateCategory($data: CategoryInput!) {\n  userUpdateCategory(data: $data) {\n    id,\n    title\n  }\n}\n\nmutation userUpdateSequenceCategory($data: [CategorySequenceInput]!) {\n  userUpdateSequenceCategory(data: $data)\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function a(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){a(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){a(e,t)})),e.definitions&&e.definitions.forEach((function(e){a(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var a=e.definitions[i];if(a.name&&a.name.value==t)return a}}function o(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var a=n[t]||new Set,o=new Set,r=new Set;a.forEach((function(e){r.add(e)}));while(r.size>0){var l=r;r=new Set,l.forEach((function(e){if(!o.has(e)){o.add(e);var t=n[e]||new Set;t.forEach((function(e){r.add(e)}))}}))}return o.forEach((function(t){var a=s(e,t);a&&i.definitions.push(a)})),i}(function(){i.definitions.forEach((function(e){if(e.name){var t=new Set;a(e,t),n[e.name.value]=t}}))})(),e.exports=i,e.exports["userCategories"]=o(i,"userCategories"),e.exports["userCategoryList"]=o(i,"userCategoryList"),e.exports["userCategory"]=o(i,"userCategory"),e.exports["userCreateCategory"]=o(i,"userCreateCategory"),e.exports["userUpdateCategory"]=o(i,"userUpdateCategory"),e.exports["userUpdateSequenceCategory"]=o(i,"userUpdateSequenceCategory")},"34d6":function(e,t){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"userAssets"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"paginator"}},type:{kind:"NamedType",name:{kind:"Name",value:"PaginatorInput"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"more"}},type:{kind:"NamedType",name:{kind:"Name",value:"AssetPaginatorInput"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userAssets"},arguments:[{kind:"Argument",name:{kind:"Name",value:"paginator"},value:{kind:"Variable",name:{kind:"Name",value:"paginator"}}},{kind:"Argument",name:{kind:"Name",value:"more"},value:{kind:"Variable",name:{kind:"Name",value:"more"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"items"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"file_size"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created_at"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updated_at"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"cursor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"total"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"userCreateBatchAsset"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AssetInput"}}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userCreateBatchAsset"},arguments:[{kind:"Argument",name:{kind:"Name",value:"data"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"userDeleteBatchAsset"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"ids"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userDeleteBatchAsset"},arguments:[{kind:"Argument",name:{kind:"Name",value:"ids"},value:{kind:"Variable",name:{kind:"Name",value:"ids"}}}],directives:[]}]}}],loc:{start:0,end:460}};i.loc.source={body:"query userAssets($paginator: PaginatorInput\n  $more: AssetPaginatorInput) {\n  userAssets(paginator: $paginator\n    more: $more) {\n    items {\n      id,\n      name,\n      url,\n      file_size,\n      type,\n      created_at,\n      updated_at\n    },\n    cursor {\n      total\n    }\n  }\n}\n\nmutation userCreateBatchAsset($data: [AssetInput!]!) {\n  userCreateBatchAsset(data: $data)\n}\n\nmutation userDeleteBatchAsset($ids: [Int]!) {\n  userDeleteBatchAsset(ids: $ids)\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function a(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){a(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){a(e,t)})),e.definitions&&e.definitions.forEach((function(e){a(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var a=e.definitions[i];if(a.name&&a.name.value==t)return a}}function o(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var a=n[t]||new Set,o=new Set,r=new Set;a.forEach((function(e){r.add(e)}));while(r.size>0){var l=r;r=new Set,l.forEach((function(e){if(!o.has(e)){o.add(e);var t=n[e]||new Set;t.forEach((function(e){r.add(e)}))}}))}return o.forEach((function(t){var a=s(e,t);a&&i.definitions.push(a)})),i}(function(){i.definitions.forEach((function(e){if(e.name){var t=new Set;a(e,t),n[e.name.value]=t}}))})(),e.exports=i,e.exports["userAssets"]=o(i,"userAssets"),e.exports["userCreateBatchAsset"]=o(i,"userCreateBatchAsset"),e.exports["userDeleteBatchAsset"]=o(i,"userDeleteBatchAsset")},"392a":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("base-page",{attrs:{title:"内容管理"},scopedSlots:e._u([{key:"sider",fn:function(){return[i("div",{staticClass:"models"},e._l(e.categories,(function(t){return i("a-menu",{key:t.id,attrs:{"default-open-keys":e.openKeys,mode:"inline"}},[i("a-sub-menu",{key:t.id},[i("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.title))]),e._l(t.customs,(function(t){return i("a-menu-item",{key:t.id,on:{click:e.menuClick}},[e._v(" "+e._s(t.zh_name)+" ")])}))],2)],1)})),1)]},proxy:!0},{key:"content",fn:function(){return[e.show_list?i("contents",{attrs:{custom:e.selectCustom},on:{update:e.update}}):e._e(),e.show_update?i("update-content",{attrs:{"data-form":e.content,custom:e.selectCustom,model:"Admin"},on:{cancel:e.cancelUpdate}}):e._e()]},proxy:!0}])})},n=[],s=(i("4160"),i("159b"),i("2af9")),o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"relative"},[i("header",{staticClass:"padding-lr-sm padding-tb-xs flex align-center justify-between solid-bottom line-grey"},[i("bg-tag",{attrs:{active:!0}},[e._v(e._s(e.custom?e.custom.zh_name+"列表":""))]),i("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.add()}}},[i("a-icon",{attrs:{type:"plus"}}),e._v("新增 ")],1)],1),i("div",{staticClass:"flex align-center padding-lr-sm solid-bottom line-grey",staticStyle:{height:"36px"}},[i("span",{staticClass:"margin-right-sm"},[e._v(e._s(e.select_num)+" 选中")]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.select_num>0,expression:"select_num > 0"}],staticClass:"flex",on:{click:e.batchDelete}},[i("bg-tag",{staticClass:"text-red"},[i("a-icon",{staticClass:"margin-right-xxs",attrs:{type:"delete"}}),e._v(" 删除 ")],1)],1)]),i("div",{staticClass:"flex justify-center margin-top-sm"},[i("a-pagination",{attrs:{showSizeChanger:"",showQuickJumper:"",total:e.total,showTotal:function(e){return"共 "+e+" 条"},pageSize:e.search.paginator.limit,defaultCurrent:1,pageSizeOptions:["10","30","50","100"]},on:{change:e.change,showSizeChange:e.showSizeChange}})],1),i("a-table",{attrs:{size:"middle",rowKey:"id",rowSelection:e.rowSelection,columns:e.columns,dataSource:e.data,loading:e.loading,pagination:!1,locale:{emptyText:"暂无数据"},scroll:e.columns.length>5?{x:2e3}:{x:100}}}),i("a-modal",{attrs:{maskClosable:!1,width:e.referenceModal.width,title:e.referenceModal.title,visible:e.referenceModal.visible,footer:null},on:{cancel:e.closeReferenceDialog}},[e.referenceModal.visible?i("ContentShow",{attrs:{"custom-id":e.referenceModal.field.reference_custom_id,ids:e.referenceModal.ids}}):e._e(),i("div",{staticStyle:{"text-align":"right"}},[i("a-button",{staticClass:"margin-right-sm",on:{click:e.closeReferenceDialog}},[e._v("关闭")])],1)],1)],1)},r=[],l=(i("c975"),i("b0c0"),i("ac1f"),i("841c"),i("8785")),c=i("438c"),d=i("ca00"),u=i("4360"),m=i("a3be"),f=i("9530"),h=i.n(f),p=i("4c87");function g(){var e=Object(l["a"])(["query "," ($paginator: PaginatorInput, $more: ","PaginatorInput) { \n            "," (paginator: $paginator, more: $more) { \n            items { \n              ","\n            },\n            cursor { total } \n            }\n          }"]);return g=function(){return e},e}function v(){var e=Object(l["a"])(["mutation "," ($id: Int!) { \n                "," (id: $id)\n              }"]);return v=function(){return e},e}function k(){var e=Object(l["a"])(["mutation "," ($ids: [Int]!) { \n                "," (ids: $ids)\n              }"]);return k=function(){return e},e}var y={name:"Contents",props:{custom:{}},components:{BgTag:s["d"],PreviewImage:p["a"],ContentShow:s["e"]},data:function(){var e=this,t={onChange:function(t,i){e.select_num=i.length;var a=[];i.forEach((function(e){a.push(e.id)})),e.ids=a},onSelect:function(e,t,i){console.log(e,t,i)},onSelectAll:function(e,t,i){console.log(e,t,i)}};return{rowSelection:t,columns:[],data:[],fields:[],fieldNames:[],select_num:0,ids:[],show_create:!1,total:0,search:{paginator:{page:1,limit:30}},referenceModal:{title:"关联信息",visible:!1,width:"80%",item:{},field:{},data:[],fields:[],fieldNames:[],ids:[]},loading:!1}},created:function(){},computed:{},mounted:function(){this.getFieldList()},methods:{add:function(e){this.$emit("update",e)},batchDelete:function(){var e=this,t="userDeleteBatch"+e.custom.name;this.$confirm({title:"确认删除选中数据吗？",confirmLoading:!0,onOk:function(){e.$apollo.mutate({mutation:h()(k(),t,t),variables:{ids:e.ids},fetchPolicy:"no-cache",context:{uri:m["a"].projectUri+u["a"].state.common.currentProject.id}}).then((function(){e.getContentList(),e.select_num=0,e.ids=[]})).catch((function(t){e.$message.warning(Object(d["a"])(t.message))}))}})},deleteItem:function(e){var t=this,i="userDelete"+t.custom.name;this.$confirm({title:"确认删除吗？",confirmLoading:!0,onOk:function(){t.$apollo.mutate({mutation:h()(v(),i,i),variables:{id:e.id},fetchPolicy:"no-cache",context:{uri:m["a"].projectUri+u["a"].state.common.currentProject.id}}).then((function(){t.getContentList()})).catch((function(e){t.$message.warning(Object(d["a"])(e.message))}))}})},showSizeChange:function(e,t){this.search.paginator.limit=t,this.getContentList()},change:function(e,t){this.search.paginator.page=e,this.search.paginator.limit=t,this.getContentList()},getFieldList:function(){var e=this,t=this.$createElement;this.data=[];var i=this;i.$apollo.query({query:c["userFields"],variables:{more:{custom_id:i.custom.id},paginator:{limit:100}},fetchPolicy:"no-cache"}).then((function(a){var n=a.data.userFields.items,s=[],o=[],r=[];n.forEach((function(e){"__typename"!=e.name&&(s.push(e),"ASSET"==e.type?r.push({title:e.zh_name,dataIndex:e.name,customRender:function(a,n){if(e.is_multiple){var s=[];return n[e.name+"Asset"].forEach((function(e){if(e){var t=i.$createElement("div",{domProps:{innerHTML:"<img src="+e.url+' height="30px" />'}});s.push(t)}})),s}var o=n[e.name+"Asset"];if(o){var r=n[e.name+"Asset"].url;return n[e.name+"Asset"].type.indexOf("image")>-1?t("preview-image",{attrs:{src:r,height:"30px"}}):r}return""}}):"REFERENCE"==e.type?r.push({title:e.zh_name,dataIndex:e.name,customRender:function(t,a){var n=i.$createElement("a",{domProps:{innerHTML:t},on:{click:function(){i.showReferenceDialog(a,e,t)}}});return n}}):"RICH_TEXT"==e.type?r.push({title:e.zh_name,dataIndex:e.name,customRender:function(e,t){var a=i.$createElement("div",{domProps:{innerHTML:e,style:"height: 100px; overflow-y: scroll; width: 200px;"}});return a}}):r.push({title:e.zh_name,dataIndex:e.name}),o.push(e.name))})),r.push({title:"添加时间",dataIndex:"created_at"}),o.push("created_at"),r.push({title:"操作",dataIndex:"action",fixed:"right",customRender:function(e,t){var a=[],n=i.$createElement("a",{domProps:{innerHTML:"编辑"},on:{click:function(){i.add(t)}}}),s=i.$createElement("span",{domProps:{innerHTML:"|",width:"10px"}}),o=i.$createElement("a",{domProps:{innerHTML:"删除"},on:{click:function(){i.deleteItem(t)}}});return a.push(n),a.push(s),a.push(o),a}}),i.fields=s,i.columns=r,i.fieldNames=o,e.getContentList()})).catch((function(t){e.$message.warning(Object(d["a"])(t.message))}))},getContentList:function(){var e=this;this.data=[];var t=this;t.loading=!0;var i="user"+t.custom.plural_name,a="id, created_at";t.fields.forEach((function(e){a+=",".concat(e.name),"ASSET"==e.type&&(a+=",".concat(e.name,"Asset {\n            created_at,\n            updated_at,\n            id,\n            name,\n            url,\n            type\n          }")),"REFERENCE"==e.type&&(a+=",".concat(e.name,"Reference {\n            created_at,\n            updated_at,\n            id,\n            title\n          }"))})),t.$apollo.query({query:h()(g(),i,t.custom.name,i,a),variables:t.search,fetchPolicy:"no-cache",context:{uri:m["a"].projectUri+u["a"].state.common.currentProject.id}}).then((function(e){t.data=e.data[i].items,t.total=e.data[i].cursor.total,t.loading=!1})).catch((function(i){e.$message.warning(Object(d["a"])(i.message)),t.loading=!1}))},showReferenceDialog:function(e,t,i){this.referenceModal.item=e,this.referenceModal.field=t,this.referenceModal.ids="string"===typeof i?[i]:i,this.referenceModal.visible=!0},closeReferenceDialog:function(){this.referenceModal.visible=!1}}},b=y,C=(i("581c"),i("06d7"),i("2877")),S=Object(C["a"])(b,o,r,!1,null,"098221df",null),_=S.exports,N=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a-layout",{staticClass:"layout"},[i("a-layout",{staticStyle:{"background-color":"white","margin-right":"240px"}},[i("a-layout-header",{staticClass:"header light",staticStyle:{height:"50px","line-height":"50px"}},[i("div",{staticClass:"flex align-center padding-lr-sm text-bold pointer text-black",on:{click:e.cancel}},[i("a-icon",{staticClass:"margin-right-xs",attrs:{type:"left"}}),e._v(" "+e._s(e.dataForm&&e.dataForm.id?"编辑":"创建")+" "+e._s(e.model)+" ")],1)]),i("a-layout-content",[i("div",{staticClass:"content-body padding-lr-sm"},[e.formShow?i("a-form-model",{ref:"createForm",attrs:{layout:"vertical",model:e.form,rules:e.rules}},[e._l(e.fields,(function(t,a){return["SINGLE_TEXT"==t.type?[i("a-form-model-item",{key:a,attrs:{label:t.zh_name,prop:t.name}},[i("a-input",{attrs:{placeholder:"请输入"+t.zh_name},on:{change:e.formValueChange},model:{value:e.form[t.name],callback:function(i){e.$set(e.form,t.name,i)},expression:"form[item.name]"}})],1)]:"MULTI_TEXT"==t.type?[i("a-form-model-item",{key:a,attrs:{label:t.zh_name,prop:t.name}},[i("a-input",{attrs:{type:"textarea",placeholder:"请输入"+t.zh_name},model:{value:e.form[t.name],callback:function(i){e.$set(e.form,t.name,i)},expression:"form[item.name]"}})],1)]:"RICH_TEXT"==t.type?[i("a-form-model-item",{key:a,attrs:{label:t.zh_name,prop:t.name}},[i("WangEditor",{attrs:{name:t.name},on:{change:e.richValueChange},model:{value:e.form[t.name],callback:function(i){e.$set(e.form,t.name,i)},expression:"form[item.name]"}})],1)]:"ASSET"==t.type?[i("a-form-model-item",{key:a,attrs:{label:t.zh_name,prop:t.name}},[e._l(e.form[t.name+"Asset"],(function(a,n){return i("div",{key:n},[i("tag",{attrs:{closable:""},on:{close:function(i){return e.removeAsset(a,t.name)}}},[e._v(e._s(a.name))])],1)})),i("a-button",{on:{click:function(i){return e.showAssetDialog(t)}}},[e._v("选择")])],2)]:"REFERENCE"==t.type?[i("a-form-model-item",{key:a,attrs:{label:t.zh_name,prop:t.name}},[t.is_required?i("a-input",{attrs:{type:"hidden"},model:{value:e.form[t.name],callback:function(i){e.$set(e.form,t.name,i)},expression:"form[item.name]"}}):e._e(),e._l(e.form[t.name+"Reference"],(function(a,n){return i("div",{key:n},[i("tag",{attrs:{closable:""},on:{close:function(i){return e.removeReference(a,t.name)}}},[e._v(e._s(a.title))])],1)})),i("a-button",{on:{click:function(i){return e.showReferenceDialog(t)}}},[e._v("选择")])],2)]:e._e()]}))],2):e._e()],1)])],1),i("a-layout-sider",{staticClass:"right-sider sider light padding-xs",style:{overflow:"auto",height:"100vh",position:"fixed",right:0,backgroundColor:"rgb(250, 250, 252)"}},[i("div",[i("a-button",{staticClass:"margin-right-xs",attrs:{type:"primary"},on:{click:e.submit}},[e._v("保存")]),i("a-button",{attrs:{type:"danger"},on:{click:e.submit}},[e._v("保存并发布")])],1),i("div",{staticClass:"text-df margin-tb"},[i("div",{staticClass:"margin-bottom-xs"},[e._v("信息")]),e.dataForm&&e.dataForm.id?i("div",{staticClass:"text-sm text-grey"},[i("div",{staticClass:"flex justify-between"},[i("span",[e._v("创建")]),i("span",[e._v("2020-04-09 18:17:54")])]),i("div",{staticClass:"flex justify-between"},[i("span",[e._v("更新")]),i("span",[e._v("2020-04-09 18:17:54")])])]):i("div",{staticClass:"text-sm text-grey margin-left-xs",staticStyle:{"font-style":"italic"}},[e._v(" 保存后显示 ")])]),i("div",{staticClass:"margin-tb"},[i("div",{staticClass:"text-df margin-bottom-xs"},[e._v("发布于")]),e.dataForm&&e.dataForm.id?i("div",{staticClass:"flex justify-between align-center padding-xs solid line-grey shadow radius",staticStyle:{"background-color":"white"}},[i("span",{staticClass:"text-sm"},[e._v("2020-04-09 18:25:11")]),i("a-tooltip",{attrs:{placement:"bottomRight"}},[i("template",{slot:"title"},[i("span",[e._v("取消发布")])]),i("a-icon",{staticClass:"pointer",staticStyle:{color:"red"},attrs:{type:"delete",theme:"filled"}})],2)],1):i("div",{staticClass:"text-sm text-grey margin-left-xs",staticStyle:{"font-style":"italic"}},[e._v(" 尚未发布 ")])])]),i("a-modal",{attrs:{maskClosable:!1,width:e.assetModal.width,title:e.assetModal.title,visible:e.assetModal.visible,footer:null},on:{cancel:e.closeAssetDialog}},[e.assetModal.visible?i("asset-picker",{attrs:{"form-name":e.assetModal.item.name,"is-multiple":e.assetModal.item.is_multiple},on:{selectChange:e.assetSelectChange}}):e._e(),i("div",{staticStyle:{"text-align":"right"}},[i("a-button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary"},on:{click:e.batchAdd}},[i("a-icon",{attrs:{type:"plus"}}),e._v("上传 ")],1),i("a-button",{staticClass:"margin-right-sm",on:{click:e.closeAssetDialog}},[e._v("关闭")])],1)],1),i("a-modal",{attrs:{maskClosable:!1,width:e.referenceModal.width,title:e.referenceModal.title,visible:e.referenceModal.visible,footer:null},on:{cancel:e.closeReferenceDialog}},[i("reference-picker",{attrs:{"form-name":e.referenceModal.item.name,"is-multiple":e.referenceModal.item.is_multiple,"custom-id":e.referenceModal.item.reference_custom_id},on:{selectChange:e.referenceSelectChange}}),i("div",{staticStyle:{"text-align":"right"}},[i("a-button",{staticClass:"margin-right-sm",on:{click:e.closeReferenceDialog}},[e._v("关闭")])],1)],1),i("a-modal",{attrs:{maskClosable:!1,width:e.uploadModal.width,title:e.uploadModal.title,visible:e.uploadModal.visible,footer:null},on:{cancel:e.closeUploadDialog}},[i("div",[i("a-layout",{staticStyle:{"background-color":"white","margin-right":"240px"}},[i("a-layout-content",[i("div",{staticClass:"content-body padding-lr-sm"},[i("a-form-model",{ref:"form",attrs:{layout:"vertical",model:e.uploadForm}},[i("a-form-model-item",{attrs:{label:"",prop:"url"}},[e.uploadModal.visible?i("batch-upload",{attrs:{data:{id:1}},on:{change:e.handleChange}}):e._e()],1)],1)],1)])],1)],1),i("div",{staticStyle:{"text-align":"right"}},[i("a-button",{attrs:{type:"primary",loading:e.submit_loading},on:{click:e.handleUpload}},[e._v("创建")]),i("a-button",{staticClass:"margin-right-sm",on:{click:e.closeUploadDialog}},[e._v("关闭")])],1)])],1)},w=[],x=(i("a15b"),i("b2a3"),i("a54e"),i("92fa")),$=i.n(x),E=i("6042"),F=i.n(E),A=i("4d91"),D=i("0c63"),T=i("94eb"),j=i("0464"),M=i("a9d4"),R=i("daa3"),I=i("b488"),O=i("4df5"),P=i("6a21"),L=["pink","red","yellow","orange","cyan","green","blue","purple","geekblue","magenta","volcano","gold","lime"],z=new RegExp("^("+L.join("|")+")(-inverse)?$"),q={name:"ATag",mixins:[I["a"]],model:{prop:"visible",event:"close.visible"},props:{prefixCls:A["a"].string,color:A["a"].string,closable:A["a"].bool.def(!1),visible:A["a"].bool,afterClose:A["a"].func},inject:{configProvider:{default:function(){return O["a"]}}},data:function(){var e=!0,t=Object(R["k"])(this);return"visible"in t&&(e=this.visible),Object(P["a"])(!("afterClose"in t),"Tag","'afterClose' will be deprecated, please use 'close' event, we will remove this in the next version."),{_visible:e}},watch:{visible:function(e){this.setState({_visible:e})}},methods:{setVisible:function(e,t){this.$emit("close",t),this.$emit("close.visible",!1);var i=this.afterClose;i&&i(),t.defaultPrevented||Object(R["r"])(this,"visible")||this.setState({_visible:e})},handleIconClick:function(e){e.stopPropagation(),this.setVisible(!1,e)},isPresetColor:function(){var e=this.$props.color;return!!e&&z.test(e)},getTagStyle:function(){var e=this.$props.color,t=this.isPresetColor();return{backgroundColor:e&&!t?e:void 0}},getTagClassName:function(e){var t,i=this.$props.color,a=this.isPresetColor();return t={},F()(t,e,!0),F()(t,e+"-"+i,a),F()(t,e+"-has-color",i&&!a),t},renderCloseIcon:function(){var e=this.$createElement,t=this.$props.closable;return t?e(D["a"],{attrs:{type:"close"},on:{click:this.handleIconClick}}):null}},render:function(){var e=arguments[0],t=this.$props.prefixCls,i=this.configProvider.getPrefixCls,a=i("tag",t),n=this.$data._visible,s=e("span",$()([{directives:[{name:"show",value:n}]},{on:Object(j["a"])(Object(R["j"])(this),["close"])},{class:this.getTagClassName(a),style:this.getTagStyle()}]),[this.$slots["default"],this.renderCloseIcon()]),o=Object(T["a"])(a+"-zoom",{appear:!1});return e(M["a"],[e("transition",o,[s])])}},U={name:"ACheckableTag",model:{prop:"checked"},props:{prefixCls:A["a"].string,checked:Boolean},inject:{configProvider:{default:function(){return O["a"]}}},computed:{classes:function(){var e,t=this.checked,i=this.prefixCls,a=this.configProvider.getPrefixCls,n=a("tag",i);return e={},F()(e,""+n,!0),F()(e,n+"-checkable",!0),F()(e,n+"-checkable-checked",t),e}},methods:{handleClick:function(){var e=this.checked;this.$emit("input",!e),this.$emit("change",!e)}},render:function(){var e=arguments[0],t=this.classes,i=this.handleClick,a=this.$slots;return e("div",{class:t,on:{click:i}},[a["default"]])}},V=i("db14");q.CheckableTag=U,q.install=function(e){e.use(V["a"]),e.component(q.name,q),e.component(q.CheckableTag.name,q.CheckableTag)};var B=q,H=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"relative"},[i("header",{staticClass:"padding-lr-sm padding-tb-xs flex align-center justify-between solid-bottom line-grey"},[i("bg-tag",{attrs:{active:!0}},[e._v("Asset")])],1),i("div",{staticClass:"flex justify-center margin-top-sm"},[i("a-pagination",{attrs:{showSizeChanger:"",showQuickJumper:"",total:e.total,showTotal:function(e){return"共 "+e+" 条"},pageSize:e.search.paginator.limit,defaultCurrent:1,pageSizeOptions:["10","30","50","100"]},on:{change:e.change,showSizeChange:e.showSizeChange}})],1),i("a-table",{attrs:{size:"middle",rowKey:"id",columns:e.columns,dataSource:e.data,loading:e.loading,pagination:!1,scroll:{x:1200,y:"calc(100vh - 10px)",scrollToFirstRowOnChange:!0}},scopedSlots:e._u([{key:"url",fn:function(t,a){return[a.type.indexOf("image")>-1?i("preview-image",{attrs:{src:t,height:"30px"}}):i("span",[e._v(e._s(t))])]}},{key:"action",fn:function(t){return[i("a",{on:{click:function(i){return e.selectItem(t)}}},[e._v("选择")])]}}])})],1)},K=[],X=i("34d6"),J={name:"AssetPicker",props:{formName:{type:String,default:""},isMultiple:{type:Boolean,default:!1}},components:{BgTag:s["d"],PreviewImage:p["a"]},data:function(){var e=this,t=[{title:"文件名",dataIndex:"name",scopedSlots:{customRender:"name"}},{title:"预览",dataIndex:"url",scopedSlots:{customRender:"url"}},{title:"大小",dataIndex:"file_size"},{title:"上传时间",dataIndex:"created_at"},{title:"选择",key:"action",scopedSlots:{customRender:"action"}}],i={onChange:function(t,i){console.log("selectedRowKeys: ".concat(t),"selectedRows: ",i),e.select_num=i.length},onSelect:function(t,i,a){console.log(t,i,a),e.$emit("selectChange",t,e.formName,e.isMultiple)},onSelectAll:function(e,t,i){console.log(e,t,i)}};return{rowSelection:i,columns:t,data:[],select_num:0,show_create:!1,total:30,search:{paginator:{page:1,limit:10}},loading:!1}},computed:{},mounted:function(){this.getList()},methods:{showSizeChange:function(e,t){this.search.paginator.limit=t,this.getList()},change:function(e,t){this.search.paginator.page=e,this.search.paginator.limit=t,this.getList()},getList:function(){var e=this,t=this;t.loading=!0,t.$apollo.query({query:X["userAssets"],variables:t.search,fetchPolicy:"no-cache",context:{uri:m["a"].projectUri+u["a"].state.common.currentProject.id}}).then((function(e){t.data=e.data.userAssets.items,t.total=e.data.userAssets.cursor.total,t.loading=!1})).catch((function(i){e.$message.warning(Object(d["a"])(i.message)),t.loading=!1}))},selectItem:function(e){this.$emit("selectChange",e,this.formName,this.isMultiple)}}},Q=J,G=(i("f79b"),i("830f"),Object(C["a"])(Q,H,K,!1,null,"db74105c",null)),W=G.exports;function Y(){var e=Object(l["a"])(["mutation "," ($data: ","Input!) { \n                "," (data: $data) {\n                  ","\n                }\n              }"]);return Y=function(){return e},e}var Z={name:"UpdateContent",props:{dataForm:{type:Object,default:function(){return{}}},custom:{},model:{type:String,required:!0}},components:{AreaUpload:s["a"],WangEditor:s["j"],AssetPicker:W,Tag:B,ReferencePicker:s["h"],BatchUpload:s["c"]},data:function(){return{fileList:[],uploadForm:this.$form.createForm(this),submit_loading:!1,form:{},fields:[],fieldNames:[],rules:{title:[{required:!0,message:"必填",trigger:"blur"}]},assetModal:{title:"选择关联附件",visible:!1,width:"80%",item:{}},uploadModal:{title:"上传",visible:!1,width:"80%"},referenceModal:{title:"选择关联表",visible:!1,width:"80%",item:{}},formShow:!0,typeTexts:{ASSET:"Asset",REFERENCE:"Reference"}}},computed:{},mounted:function(){this.getFieldList()},methods:{goSchema:function(){this.$router.push({name:"Schema"})},handleChange:function(e){this.fileList=e},handleUpload:function(e){var t=this;e.preventDefault();var i=this;if(0!==this.fileList.length){var a=[];this.fileList.forEach((function(e){a.push({name:e.name,url:e.url,type:e.mime,file_size:e.size,is_system:"false"})})),i.$apollo.mutate({mutation:X["userCreateBatchAsset"],variables:{data:a},fetchPolicy:"no-cache",context:{uri:m["a"].projectUri+u["a"].state.common.currentProject.id}}).then((function(){i.closeUploadDialog(),i.fileList=[]})).catch((function(e){t.$message.warning(Object(d["a"])(e.message))}))}else this.$message.warning("请上传文件")},batchAdd:function(){this.showUploadDialog()},cancel:function(){this.$emit("cancel")},submit:function(){var e=this,t=this;this.$refs.createForm.validate((function(i){if(!i)return!1;var a={};t.fields.forEach((function(e){if("ASSET"==e.type||"REFERENCE"==e.type){var i=[];if(e.is_multiple){var n=t.form[e.name+t.typeTexts[e.type]];n&&n.length>0&&t.form[e.name+t.typeTexts[e.type]].forEach((function(e){i.push(e.id)})),a[e.name]=i}else{var s=t.form[e.name+t.typeTexts[e.type]];a[e.name]=s&&s.length>0?s[0].id:void 0}}else a[e.name]=t.form[e.name]}));var n="userCreate";t.form.id&&(n="userUpdate",a["id"]=t.form.id),n+=t.custom.name,t.$apollo.mutate({mutation:h()(Y(),n,t.custom.name,n,t.fieldNames.join(",")),variables:{data:a},fetchPolicy:"no-cache",context:{uri:m["a"].projectUri+u["a"].state.common.currentProject.id}}).then((function(){e.$emit("cancel")})).catch((function(t){e.$message.warning(Object(d["a"])(t.message))}))}))},getFieldList:function(){var e=this,t=this;t.$apollo.query({query:c["userFields"],variables:{more:{custom_id:t.custom.id},paginator:{limit:100}},fetchPolicy:"no-cache"}).then((function(e){var i=e.data.userFields.items,a=[],n=[],s={};t.formShow=!1;var o=t.dataForm;i.forEach((function(e){if(a.push(e),n.push(e.name),e.is_required){var i="请输入";"ASSET"!=e.type&&"REFERENCE"!=e.type||(i="请选择"),s[e.name]=[{type:"string",required:!0,message:i+e.zh_name,trigger:"blur"}]}if(o&&o.id&&("RICH_TEXT"==e.type&&(t.form[e.name]=""),t.form[e.name]=o[e.name],"ASSET"==e.type||"REFERENCE"==e.type)){var r=t.typeTexts[e.type],l=[];e.is_multiple?l=o[e.name+r]:o[e.name+r]&&(l=[o[e.name+r]]),t.form[e.name+r]=l}})),o&&o.id?t.form["id"]=o.id:t.form["id"]=void 0,t.rules=s,t.fields=a,t.fieldNames=n,t.formShow=!0})).catch((function(t){e.$message.warning(Object(d["a"])(t.message))}))},richValueChange:function(e){var t=e[0],i=e[1];this.form[i]=t},showAssetDialog:function(e){this.assetModal.item=e,this.assetModal.visible=!0},closeAssetDialog:function(){this.assetModal.visible=!1},assetSelectChange:function(e,t,i){this.selectChange("asset",e,t,i)},removeAsset:function(e,t){var i=[],a=[];this.form[t+"Asset"].forEach((function(t){t.id!=e.id&&(i.push(t),e.is_multiple?a.push(t.id):a=t.id)})),this.form[t+"Asset"]=i,this.form[t]=a},removeReference:function(e,t){var i=[],a=[];this.form[t+"Reference"].forEach((function(t){t.id!=e.id&&(i.push(t),e.is_multiple?a.push(t.id):a=t.id)})),this.form[t+"Reference"]=i,this.form[t]=a},showReferenceDialog:function(e){this.referenceModal.item=e,this.referenceModal.visible=!0},closeReferenceDialog:function(){this.referenceModal.visible=!1},showUploadDialog:function(){console.log(this.fileList),this.fileList=[],this.assetModal.visible=!1,this.uploadModal.visible=!0},closeUploadDialog:function(){this.uploadModal.visible=!1,this.assetModal.visible=!0},selectChange:function(e,t,i,a){console.log(this.$refs.createForm);var n="";if(n="asset"==e?"Asset":"Reference",a){var s=!1;this.form[i+n]&&this.form[i+n].length>0&&this.form[i+n].forEach((function(e){e.id==t.id&&(s=!0)})),s||(this.form[i+n]&&this.form[i+n].length>0?this.form[i+n].push(t):this.form[i+n]=[t],a?this.form[i].push(t.id):this.form[i]=t.id),this.$refs.createForm.clearValidate()}else this.form[i+n]=[t],a?this.form[i].push(t.id):this.form[i]=t.id,this.$refs.createForm.clearValidate(),"asset"==e?this.closeAssetDialog():this.closeReferenceDialog()},referenceSelectChange:function(e,t,i){this.selectChange("reference",e,t,i)},formValueChange:function(){this.form=Object.assign({},this.form)}}},ee=Z,te=(i("783b"),Object(C["a"])(ee,N,w,!1,null,"7cdba796",null)),ie=te.exports,ae=i("21b3"),ne={components:{UpdateContent:ie,Contents:_,BasePage:s["b"]},data:function(){return{content:{id:1},show_list:!1,selectedTags:[],customs:[],selectCustom:null,show_update:!1,show_models:!0,models_height:"0px",categories:[],openKeys:[]}},computed:{toggleDirection:function(){return this.show_models?"down":"right"}},mounted:function(){this.getCustomList()},methods:{getCustomList:function(){var e=this,t=this;t.$apollo.query({query:ae["userCategoryList"],variables:{},fetchPolicy:"no-cache"}).then((function(e){t.categories=e.data.userCategories.items;var i=[];t.categories.forEach((function(e){i.push(e.id)})),t.openKeys=i})).catch((function(t){e.$message.warning(Object(d["a"])(t.message))}))},menuClick:function(e){this.selectCustom=null,this.show_list=!1,this.show_update=!1;var t=this;setTimeout((function(){var i=null;t.categories.forEach((function(t){t.customs.forEach((function(t){t.id===e.key&&(i=t)}))})),t.selectCustom=i,t.show_list=!0}),100)},cancelUpdate:function(){this.show_update=!1,this.show_list=!0},update:function(e){this.show_list=!1,this.content=e?e||{}:void 0;var t=this;setTimeout((function(){t.show_update=!0}),100)}}},se=ne,oe=(i("8816"),Object(C["a"])(se,a,n,!1,null,"042fbfaa",null));t["default"]=oe.exports},"581c":function(e,t,i){"use strict";var a=i("ac79"),n=i.n(a);n.a},"75b0":function(e,t,i){},"783b":function(e,t,i){"use strict";var a=i("a078"),n=i.n(a);n.a},"830f":function(e,t,i){"use strict";var a=i("9dab"),n=i.n(a);n.a},8816:function(e,t,i){"use strict";var a=i("75b0"),n=i.n(a);n.a},"9dab":function(e,t,i){},a078:function(e,t,i){},a15b:function(e,t,i){"use strict";var a=i("23e7"),n=i("44ad"),s=i("fc6a"),o=i("a640"),r=[].join,l=n!=Object,c=o("join",",");a({target:"Array",proto:!0,forced:l||!c},{join:function(e){return r.call(s(this),void 0===e?",":e)}})},a54e:function(e,t,i){},ac79:function(e,t,i){},b7d2:function(e,t,i){},f79b:function(e,t,i){"use strict";var a=i("b7d2"),n=i.n(a);n.a},fb59:function(e,t,i){}}]);
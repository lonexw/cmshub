(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-84f94734"],{"1b22":function(e,t,i){"use strict";var n=i("b999"),a=i.n(n);a.a},"21b3":function(e,t){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"userCategories"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userCategories"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"items"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"userCategoryList"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userCategories"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"items"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"customs"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"zh_name"},arguments:[],directives:[]}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"userCategory"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userCategory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"userCreateCategory"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CategoryInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userCreateCategory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"data"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"userUpdateCategory"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CategoryInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userUpdateCategory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"data"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:554}};i.loc.source={body:"query userCategories {\n  userCategories {\n    items {\n      id,\n      title\n    }\n  }\n}\n\nquery userCategoryList {\n  userCategories {\n    items {\n      id\n      title\n      customs {\n        id\n        name\n        zh_name\n      }\n    }\n  }\n}\n\nquery userCategory ($id: Int!) {\n  userCategory (id: $id) {\n    id\n    title\n  }\n}\n\nmutation userCreateCategory($data: CategoryInput!) {\n  userCreateCategory(data: $data) {\n    id,\n    title\n  }\n}\n\nmutation userUpdateCategory($data: CategoryInput!) {\n  userUpdateCategory(data: $data) {\n    id,\n    title\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function n(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){n(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){n(e,t)})),e.definitions&&e.definitions.forEach((function(e){n(e,t)}))}var a={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function o(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=a[t]||new Set,o=new Set,r=new Set;n.forEach((function(e){r.add(e)}));while(r.size>0){var l=r;r=new Set,l.forEach((function(e){if(!o.has(e)){o.add(e);var t=a[e]||new Set;t.forEach((function(e){r.add(e)}))}}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}(function(){i.definitions.forEach((function(e){if(e.name){var t=new Set;n(e,t),a[e.name.value]=t}}))})(),e.exports=i,e.exports["userCategories"]=o(i,"userCategories"),e.exports["userCategoryList"]=o(i,"userCategoryList"),e.exports["userCategory"]=o(i,"userCategory"),e.exports["userCreateCategory"]=o(i,"userCreateCategory"),e.exports["userUpdateCategory"]=o(i,"userUpdateCategory")},2226:function(e,t,i){"use strict";var n=i("6f06"),a=i.n(n);a.a},2366:function(e,t,i){},"34d6":function(e,t){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"userAssets"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"paginator"}},type:{kind:"NamedType",name:{kind:"Name",value:"PaginatorInput"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"more"}},type:{kind:"NamedType",name:{kind:"Name",value:"AssetPaginatorInput"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userAssets"},arguments:[{kind:"Argument",name:{kind:"Name",value:"paginator"},value:{kind:"Variable",name:{kind:"Name",value:"paginator"}}},{kind:"Argument",name:{kind:"Name",value:"more"},value:{kind:"Variable",name:{kind:"Name",value:"more"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"items"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"file_size"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created_at"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updated_at"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"cursor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"total"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"userCreateBatchAsset"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AssetInput"}}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userCreateBatchAsset"},arguments:[{kind:"Argument",name:{kind:"Name",value:"data"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"userDeleteBatchAsset"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"ids"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userDeleteBatchAsset"},arguments:[{kind:"Argument",name:{kind:"Name",value:"ids"},value:{kind:"Variable",name:{kind:"Name",value:"ids"}}}],directives:[]}]}}],loc:{start:0,end:460}};i.loc.source={body:"query userAssets($paginator: PaginatorInput\n  $more: AssetPaginatorInput) {\n  userAssets(paginator: $paginator\n    more: $more) {\n    items {\n      id,\n      name,\n      url,\n      file_size,\n      type,\n      created_at,\n      updated_at\n    },\n    cursor {\n      total\n    }\n  }\n}\n\nmutation userCreateBatchAsset($data: [AssetInput!]!) {\n  userCreateBatchAsset(data: $data)\n}\n\nmutation userDeleteBatchAsset($ids: [Int]!) {\n  userDeleteBatchAsset(ids: $ids)\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function n(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){n(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){n(e,t)})),e.definitions&&e.definitions.forEach((function(e){n(e,t)}))}var a={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function o(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=a[t]||new Set,o=new Set,r=new Set;n.forEach((function(e){r.add(e)}));while(r.size>0){var l=r;r=new Set,l.forEach((function(e){if(!o.has(e)){o.add(e);var t=a[e]||new Set;t.forEach((function(e){r.add(e)}))}}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}(function(){i.definitions.forEach((function(e){if(e.name){var t=new Set;n(e,t),a[e.name.value]=t}}))})(),e.exports=i,e.exports["userAssets"]=o(i,"userAssets"),e.exports["userCreateBatchAsset"]=o(i,"userCreateBatchAsset"),e.exports["userDeleteBatchAsset"]=o(i,"userDeleteBatchAsset")},"392a":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("base-page",{attrs:{title:"内容管理"},scopedSlots:e._u([{key:"sider",fn:function(){return[i("div",{staticClass:"models"},e._l(e.categories,(function(t){return i("a-menu",{key:t.id,attrs:{"default-open-keys":e.openKeys,mode:"inline"}},[i("a-sub-menu",{key:t.id},[i("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.title))]),e._l(t.customs,(function(t){return i("a-menu-item",{key:t.id,on:{click:e.menuClick}},[e._v(" "+e._s(t.zh_name)+" ")])}))],2)],1)})),1)]},proxy:!0},{key:"content",fn:function(){return[e.show_list?i("contents",{attrs:{custom:e.selectCustom},on:{update:e.update}}):e._e(),e.show_update?i("update-content",{attrs:{"data-form":e.content,custom:e.selectCustom,model:"Admin"},on:{cancel:e.cancelUpdate}}):e._e()]},proxy:!0}])})},a=[],s=(i("4160"),i("159b"),i("2af9")),o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"relative"},[i("header",{staticClass:"padding-lr-sm padding-tb-xs flex align-center justify-between solid-bottom line-grey"},[i("bg-tag",{attrs:{active:!0}},[e._v(e._s(e.custom?e.custom.zh_name+"列表":""))]),i("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.add()}}},[i("a-icon",{attrs:{type:"plus"}}),e._v("新增 ")],1)],1),i("div",{staticClass:"flex align-center padding-lr-sm solid-bottom line-grey",staticStyle:{height:"36px"}},[i("span",{staticClass:"margin-right-sm"},[e._v(e._s(e.select_num)+" 选中")]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.select_num>0,expression:"select_num > 0"}],staticClass:"flex",on:{click:e.batchDelete}},[i("bg-tag",{staticClass:"text-red"},[i("a-icon",{staticClass:"margin-right-xxs",attrs:{type:"delete"}}),e._v(" 删除 ")],1)],1)]),i("div",{staticClass:"flex justify-center margin-top-sm"},[i("a-pagination",{attrs:{showSizeChanger:"",showQuickJumper:"",total:e.total,showTotal:function(e){return"共 "+e+" 条"},pageSize:e.search.paginator.limit,defaultCurrent:1,pageSizeOptions:["10","30","50","100"]},on:{change:e.change,showSizeChange:e.showSizeChange}})],1),i("a-table",{attrs:{size:"middle",rowKey:"id",rowSelection:e.rowSelection,columns:e.columns,dataSource:e.data,loading:e.loading,pagination:!1,locale:{emptyText:"暂无数据"},scroll:{scrollToFirstRowOnChange:!0}}}),i("a-modal",{attrs:{maskClosable:!1,width:e.referenceModal.width,title:e.referenceModal.title,visible:e.referenceModal.visible,footer:null},on:{cancel:e.closeReferenceDialog}},[e.referenceModal.visible?i("ContentShow",{attrs:{"custom-id":e.referenceModal.field.reference_custom_id,ids:e.referenceModal.ids}}):e._e(),i("div",{staticStyle:{"text-align":"right"}},[i("a-button",{staticClass:"margin-right-sm",on:{click:e.closeReferenceDialog}},[e._v("关闭")])],1)],1)],1)},r=[],l=(i("c975"),i("b0c0"),i("ac1f"),i("841c"),i("8785")),c=i("438c"),d=i("ca00"),u=i("4360"),m=i("a3be"),f=i("9530"),h=i.n(f),p=i("4c87");function g(){var e=Object(l["a"])(["query "," ($paginator: PaginatorInput, $more: ","PaginatorInput) { \n            "," (paginator: $paginator, more: $more) { \n            items { \n              ","\n            },\n            cursor { total } \n            }\n          }"]);return g=function(){return e},e}function v(){var e=Object(l["a"])(["mutation "," ($id: Int!) { \n                "," (id: $id)\n              }"]);return v=function(){return e},e}function k(){var e=Object(l["a"])(["mutation "," ($ids: [Int]!) { \n                "," (ids: $ids)\n              }"]);return k=function(){return e},e}var y={name:"Contents",props:{custom:{}},components:{BgTag:s["d"],PreviewImage:p["a"],ContentShow:s["e"]},data:function(){var e=this,t={onChange:function(t,i){e.select_num=i.length;var n=[];i.forEach((function(e){n.push(e.id)})),e.ids=n},onSelect:function(e,t,i){console.log(e,t,i)},onSelectAll:function(e,t,i){console.log(e,t,i)}};return{rowSelection:t,columns:[],data:[],fields:[],fieldNames:[],select_num:0,ids:[],show_create:!1,total:0,search:{paginator:{page:1,limit:30}},referenceModal:{title:"关联信息",visible:!1,width:"80%",item:{},field:{},data:[],fields:[],fieldNames:[],ids:[]},loading:!1}},created:function(){},computed:{},mounted:function(){this.getFieldList()},methods:{add:function(e){this.$emit("update",e)},batchDelete:function(){var e=this,t="userDeleteBatch"+e.custom.name;this.$confirm({title:"确认删除选中数据吗？",confirmLoading:!0,onOk:function(){e.$apollo.mutate({mutation:h()(k(),t,t),variables:{ids:e.ids},fetchPolicy:"no-cache",context:{uri:m["a"].projectUri+u["a"].state.common.currentProject.id}}).then((function(){e.getContentList(),e.select_num=0,e.ids=[]})).catch((function(t){e.$message.warning(Object(d["a"])(t.message))}))}})},deleteItem:function(e){var t=this,i="userDelete"+t.custom.name;this.$confirm({title:"确认删除吗？",confirmLoading:!0,onOk:function(){t.$apollo.mutate({mutation:h()(v(),i,i),variables:{id:e.id},fetchPolicy:"no-cache",context:{uri:m["a"].projectUri+u["a"].state.common.currentProject.id}}).then((function(){t.getContentList()})).catch((function(e){t.$message.warning(Object(d["a"])(e.message))}))}})},showSizeChange:function(e,t){this.search.paginator.limit=t,this.getContentList()},change:function(e,t){this.search.paginator.page=e,this.search.paginator.limit=t,this.getContentList()},getFieldList:function(){var e=this,t=this.$createElement;this.data=[];var i=this;i.$apollo.query({query:c["userFields"],variables:{more:{custom_id:i.custom.id}},fetchPolicy:"no-cache"}).then((function(n){var a=n.data.userFields.items,s=[],o=[],r=[];a.forEach((function(e){"__typename"!=e.name&&(s.push(e),"ASSET"==e.type?r.push({title:e.zh_name,dataIndex:e.name,customRender:function(i,n){if(e.is_multiple){var a=null;return n[e.name+"Asset"].forEach((function(e){e&&(a+=t("img",{attrs:{src:e.url}}))})),a}var s=n[e.name+"Asset"];if(s){var o=n[e.name+"Asset"].url;return n[e.name+"Asset"].type.indexOf("image")>-1?t("preview-image",{attrs:{src:o,height:"30px"}}):o}return""}}):"REFERENCE"==e.type?r.push({title:e.zh_name,dataIndex:e.name,customRender:function(t,n){var a=i.$createElement("a",{domProps:{innerHTML:t},on:{click:function(){i.showReferenceDialog(n,e,t)}}});return a}}):"RICH_TEXT"==e.type?r.push({title:e.zh_name,dataIndex:e.name,customRender:function(e,t){var n=i.$createElement("div",{domProps:{innerHTML:e,style:"height: 100px; overflow-y: scroll; width: 200px;"}});return n}}):r.push({title:e.zh_name,dataIndex:e.name}),o.push(e.name))})),r.push({title:"操作",dataIndex:"action",customRender:function(e,t){var n=[],a=i.$createElement("a",{domProps:{innerHTML:"编辑"},on:{click:function(){i.add(t)}}}),s=i.$createElement("span",{domProps:{innerHTML:"|",width:"10px"}}),o=i.$createElement("a",{domProps:{innerHTML:"删除"},on:{click:function(){i.deleteItem(t)}}});return n.push(a),n.push(s),n.push(o),n}}),i.fields=s,i.columns=r,i.fieldNames=o,e.getContentList()})).catch((function(t){e.$message.warning(Object(d["a"])(t.message))}))},getContentList:function(){var e=this;this.data=[];var t=this;t.loading=!0;var i="user"+t.custom.plural_name,n="id";t.fields.forEach((function(e){n+=",".concat(e.name),"ASSET"==e.type&&(n+=",".concat(e.name,"Asset {\n            created_at,\n            updated_at,\n            id,\n            name,\n            url,\n            type\n          }")),"REFERENCE"==e.type&&(n+=",".concat(e.name,"Reference {\n            created_at,\n            updated_at,\n            id,\n            title\n          }"))})),t.$apollo.query({query:h()(g(),i,t.custom.name,i,n),variables:t.search,fetchPolicy:"no-cache",context:{uri:m["a"].projectUri+u["a"].state.common.currentProject.id}}).then((function(e){t.data=e.data[i].items,t.total=e.data[i].cursor.total,t.loading=!1})).catch((function(i){e.$message.warning(Object(d["a"])(i.message)),t.loading=!1}))},showReferenceDialog:function(e,t,i){this.referenceModal.item=e,this.referenceModal.field=t,this.referenceModal.ids="string"===typeof i?[i]:i,this.referenceModal.visible=!0},closeReferenceDialog:function(){this.referenceModal.visible=!1}}},b=y,C=(i("581c"),i("7320e"),i("2877")),S=Object(C["a"])(b,o,r,!1,null,"75b09ba6",null),_=S.exports,w=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a-layout",{staticClass:"layout"},[i("a-layout",{staticStyle:{"background-color":"white","margin-right":"240px"}},[i("a-layout-header",{staticClass:"header light",staticStyle:{height:"50px","line-height":"50px"}},[i("div",{staticClass:"flex align-center padding-lr-sm text-bold pointer text-black",on:{click:e.cancel}},[i("a-icon",{staticClass:"margin-right-xs",attrs:{type:"left"}}),e._v(" "+e._s(e.dataForm&&e.dataForm.id?"编辑":"创建")+" "+e._s(e.model)+" ")],1)]),i("a-layout-content",[i("div",{staticClass:"content-body padding-lr-sm"},[e.formShow?i("a-form-model",{ref:"createForm",attrs:{layout:"vertical",model:e.form,rules:e.rules}},[e._l(e.fields,(function(t,n){return["SINGLE_TEXT"==t.type?[i("a-form-model-item",{key:n,attrs:{label:t.zh_name,prop:t.name}},[i("a-input",{attrs:{placeholder:"请输入"+t.zh_name},on:{change:e.formValueChange},model:{value:e.form[t.name],callback:function(i){e.$set(e.form,t.name,i)},expression:"form[item.name]"}})],1)]:"MULTI_TEXT"==t.type?[i("a-form-model-item",{key:n,attrs:{label:t.zh_name,prop:t.name}},[i("a-input",{attrs:{type:"textarea",placeholder:"请输入"+t.zh_name},model:{value:e.form[t.name],callback:function(i){e.$set(e.form,t.name,i)},expression:"form[item.name]"}})],1)]:"RICH_TEXT"==t.type?[i("a-form-model-item",{key:n,attrs:{label:t.zh_name,prop:t.name}},[i("WangEditor",{attrs:{name:t.name},on:{change:e.richValueChange},model:{value:e.form[t.name],callback:function(i){e.$set(e.form,t.name,i)},expression:"form[item.name]"}})],1)]:"ASSET"==t.type?[i("a-form-model-item",{key:n,attrs:{label:t.zh_name,prop:t.name}},[e._l(e.form[t.name+"Asset"],(function(n,a){return i("div",{key:a},[i("tag",{attrs:{closable:""},on:{close:function(i){return e.removeAsset(n,t.name)}}},[e._v(e._s(n.name))])],1)})),i("a-button",{on:{click:function(i){return e.showAssetDialog(t)}}},[e._v("选择")])],2)]:"REFERENCE"==t.type?[i("a-form-model-item",{key:n,attrs:{label:t.zh_name,prop:t.name}},[t.is_required?i("a-input",{attrs:{type:"hidden"},model:{value:e.form[t.name],callback:function(i){e.$set(e.form,t.name,i)},expression:"form[item.name]"}}):e._e(),e._l(e.form[t.name+"Reference"],(function(n,a){return i("div",{key:a},[i("tag",{attrs:{closable:""},on:{close:function(i){return e.removeReference(n,t.name)}}},[e._v(e._s(n.title))])],1)})),i("a-button",{on:{click:function(i){return e.showReferenceDialog(t)}}},[e._v("选择")])],2)]:e._e()]}))],2):e._e()],1)])],1),i("a-layout-sider",{staticClass:"right-sider sider light padding-xs",style:{overflow:"auto",height:"100vh",position:"fixed",right:0,backgroundColor:"rgb(250, 250, 252)"}},[i("div",[i("a-button",{staticClass:"margin-right-xs",attrs:{type:"primary"},on:{click:e.submit}},[e._v("保存")]),i("a-button",{attrs:{type:"danger"},on:{click:e.submit}},[e._v("保存并发布")])],1),i("div",{staticClass:"text-df margin-tb"},[i("div",{staticClass:"margin-bottom-xs"},[e._v("信息")]),e.dataForm&&e.dataForm.id?i("div",{staticClass:"text-sm text-grey"},[i("div",{staticClass:"flex justify-between"},[i("span",[e._v("创建")]),i("span",[e._v("2020-04-09 18:17:54")])]),i("div",{staticClass:"flex justify-between"},[i("span",[e._v("更新")]),i("span",[e._v("2020-04-09 18:17:54")])])]):i("div",{staticClass:"text-sm text-grey margin-left-xs",staticStyle:{"font-style":"italic"}},[e._v("保存后显示")])]),i("div",{staticClass:"margin-tb"},[i("div",{staticClass:"text-df margin-bottom-xs"},[e._v("发布于")]),e.dataForm&&e.dataForm.id?i("div",{staticClass:"flex justify-between align-center padding-xs solid line-grey shadow radius",staticStyle:{"background-color":"white"}},[i("span",{staticClass:"text-sm"},[e._v("2020-04-09 18:25:11")]),i("a-tooltip",{attrs:{placement:"bottomRight"}},[i("template",{slot:"title"},[i("span",[e._v("取消发布")])]),i("a-icon",{staticClass:"pointer",staticStyle:{color:"red"},attrs:{type:"delete",theme:"filled"}})],2)],1):i("div",{staticClass:"text-sm text-grey margin-left-xs",staticStyle:{"font-style":"italic"}},[e._v("尚未发布")])])]),i("a-modal",{attrs:{maskClosable:!1,width:e.assetModal.width,title:e.assetModal.title,visible:e.assetModal.visible,footer:null},on:{cancel:e.closeAssetDialog}},[i("asset-picker",{attrs:{"form-name":e.assetModal.item.name,"is-multiple":e.assetModal.item.is_multiple},on:{selectChange:e.assetSelectChange}}),i("div",{staticStyle:{"text-align":"right"}},[i("a-button",{staticClass:"margin-right-sm",on:{click:e.closeAssetDialog}},[e._v("关闭")])],1)],1),i("a-modal",{attrs:{maskClosable:!1,width:e.referenceModal.width,title:e.referenceModal.title,visible:e.referenceModal.visible,footer:null},on:{cancel:e.closeReferenceDialog}},[i("reference-picker",{attrs:{"form-name":e.referenceModal.item.name,"is-multiple":e.referenceModal.item.is_multiple,"custom-id":e.referenceModal.item.reference_custom_id},on:{selectChange:e.referenceSelectChange}}),i("div",{staticStyle:{"text-align":"right"}},[i("a-button",{staticClass:"margin-right-sm",on:{click:e.closeReferenceDialog}},[e._v("关闭")])],1)],1)],1)},N=[],x=(i("a15b"),i("b2a3"),i("a54e"),i("92fa")),E=i.n(x),$=i("6042"),A=i.n($),T=i("4d91"),F=i("0c63"),D=i("94eb"),j=i("0464"),R=i("a9d4"),O=i("daa3"),I=i("b488"),P=i("4df5"),M=i("6a21"),z=["pink","red","yellow","orange","cyan","green","blue","purple","geekblue","magenta","volcano","gold","lime"],L=new RegExp("^("+z.join("|")+")(-inverse)?$"),V={name:"ATag",mixins:[I["a"]],model:{prop:"visible",event:"close.visible"},props:{prefixCls:T["a"].string,color:T["a"].string,closable:T["a"].bool.def(!1),visible:T["a"].bool,afterClose:T["a"].func},inject:{configProvider:{default:function(){return P["a"]}}},data:function(){var e=!0,t=Object(O["k"])(this);return"visible"in t&&(e=this.visible),Object(M["a"])(!("afterClose"in t),"Tag","'afterClose' will be deprecated, please use 'close' event, we will remove this in the next version."),{_visible:e}},watch:{visible:function(e){this.setState({_visible:e})}},methods:{setVisible:function(e,t){this.$emit("close",t),this.$emit("close.visible",!1);var i=this.afterClose;i&&i(),t.defaultPrevented||Object(O["r"])(this,"visible")||this.setState({_visible:e})},handleIconClick:function(e){e.stopPropagation(),this.setVisible(!1,e)},isPresetColor:function(){var e=this.$props.color;return!!e&&L.test(e)},getTagStyle:function(){var e=this.$props.color,t=this.isPresetColor();return{backgroundColor:e&&!t?e:void 0}},getTagClassName:function(e){var t,i=this.$props.color,n=this.isPresetColor();return t={},A()(t,e,!0),A()(t,e+"-"+i,n),A()(t,e+"-has-color",i&&!n),t},renderCloseIcon:function(){var e=this.$createElement,t=this.$props.closable;return t?e(F["a"],{attrs:{type:"close"},on:{click:this.handleIconClick}}):null}},render:function(){var e=arguments[0],t=this.$props.prefixCls,i=this.configProvider.getPrefixCls,n=i("tag",t),a=this.$data._visible,s=e("span",E()([{directives:[{name:"show",value:a}]},{on:Object(j["a"])(Object(O["j"])(this),["close"])},{class:this.getTagClassName(n),style:this.getTagStyle()}]),[this.$slots["default"],this.renderCloseIcon()]),o=Object(D["a"])(n+"-zoom",{appear:!1});return e(R["a"],[e("transition",o,[s])])}},q={name:"ACheckableTag",model:{prop:"checked"},props:{prefixCls:T["a"].string,checked:Boolean},inject:{configProvider:{default:function(){return P["a"]}}},computed:{classes:function(){var e,t=this.checked,i=this.prefixCls,n=this.configProvider.getPrefixCls,a=n("tag",i);return e={},A()(e,""+a,!0),A()(e,a+"-checkable",!0),A()(e,a+"-checkable-checked",t),e}},methods:{handleClick:function(){var e=this.checked;this.$emit("input",!e),this.$emit("change",!e)}},render:function(){var e=arguments[0],t=this.classes,i=this.handleClick,n=this.$slots;return e("div",{class:t,on:{click:i}},[n["default"]])}},B=i("db14");V.CheckableTag=q,V.install=function(e){e.use(B["a"]),e.component(V.name,V),e.component(V.CheckableTag.name,V.CheckableTag)};var U=V,H=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"relative"},[i("header",{staticClass:"padding-lr-sm padding-tb-xs flex align-center justify-between solid-bottom line-grey"},[i("bg-tag",{attrs:{active:!0}},[e._v("Asset")])],1),i("div",{staticClass:"flex justify-center margin-top-sm"},[i("a-pagination",{attrs:{showSizeChanger:"",showQuickJumper:"",total:e.total,showTotal:function(e){return"共 "+e+" 条"},pageSize:e.search.paginator.limit,defaultCurrent:1,pageSizeOptions:["10","30","50","100"]},on:{change:e.change,showSizeChange:e.showSizeChange}})],1),i("a-table",{attrs:{size:"middle",rowKey:"id",columns:e.columns,dataSource:e.data,loading:e.loading,pagination:!1,scroll:{x:1200,y:"calc(100vh - 10px)",scrollToFirstRowOnChange:!0}},scopedSlots:e._u([{key:"url",fn:function(t,n){return[n.type.indexOf("image")>-1?i("preview-image",{attrs:{src:t,height:"30px"}}):i("span",[e._v(e._s(t))])]}},{key:"action",fn:function(t){return[i("a",{on:{click:function(i){return e.selectItem(t)}}},[e._v("选择")])]}}])})],1)},K=[],X=i("34d6"),J={name:"AssetPicker",props:{formName:{type:String,default:""},isMultiple:{type:Boolean,default:!1}},components:{BgTag:s["d"],PreviewImage:p["a"]},data:function(){var e=this,t=[{title:"文件名",dataIndex:"name",scopedSlots:{customRender:"name"}},{title:"预览",dataIndex:"url",scopedSlots:{customRender:"url"}},{title:"大小",dataIndex:"file_size"},{title:"上传时间",dataIndex:"created_at"},{title:"选择",key:"action",scopedSlots:{customRender:"action"}}],i={onChange:function(t,i){console.log("selectedRowKeys: ".concat(t),"selectedRows: ",i),e.select_num=i.length},onSelect:function(t,i,n){console.log(t,i,n),e.$emit("selectChange",t,e.formName,e.isMultiple)},onSelectAll:function(e,t,i){console.log(e,t,i)}};return{rowSelection:i,columns:t,data:[],select_num:0,show_create:!1,total:30,search:{paginator:{page:1,limit:10}},loading:!1}},computed:{},mounted:function(){this.getList()},methods:{showSizeChange:function(e,t){this.search.paginator.limit=t,this.getList()},change:function(e,t){this.search.paginator.page=e,this.search.paginator.limit=t,this.getList()},getList:function(){var e=this,t=this;t.loading=!0,t.$apollo.query({query:X["userAssets"],variables:t.search,fetchPolicy:"no-cache",context:{uri:m["a"].projectUri+u["a"].state.common.currentProject.id}}).then((function(e){t.data=e.data.userAssets.items,t.total=e.data.userAssets.cursor.total,t.loading=!1})).catch((function(i){e.$message.warning(Object(d["a"])(i.message)),t.loading=!1}))},selectItem:function(e){this.$emit("selectChange",e,this.formName,this.isMultiple)}}},Q=J,G=(i("f79b"),i("830f"),Object(C["a"])(Q,H,K,!1,null,"db74105c",null)),W=G.exports;function Y(){var e=Object(l["a"])(["mutation "," ($data: ","Input!) { \n                "," (data: $data) {\n                  ","\n                }\n              }"]);return Y=function(){return e},e}var Z={name:"UpdateContent",props:{dataForm:{type:Object,default:function(){return{}}},custom:{},model:{type:String,required:!0}},components:{AreaUpload:s["a"],WangEditor:s["j"],AssetPicker:W,Tag:U,ReferencePicker:s["h"]},data:function(){return{form:{},fields:[],fieldNames:[],rules:{title:[{required:!0,message:"必填",trigger:"blur"}]},assetModal:{title:"选择关联附件",visible:!1,width:"80%",item:{}},referenceModal:{title:"选择关联表",visible:!1,width:"80%",item:{}},formShow:!0,typeTexts:{ASSET:"Asset",REFERENCE:"Reference"}}},computed:{},mounted:function(){this.getFieldList()},methods:{cancel:function(){this.$emit("cancel")},submit:function(){var e=this,t=this;this.$refs.createForm.validate((function(i){if(!i)return!1;var n={};t.fields.forEach((function(e){if("ASSET"==e.type||"REFERENCE"==e.type){var i=[];e.is_multiple?(t.form[e.name+t.typeTexts[e.type]]&&t.form[e.name+t.typeTexts[e.type]].forEach((function(e){i.push(e.id)})),n[e.name]=i):n[e.name]=t.form[e.name+t.typeTexts[e.type]].length>0?t.form[e.name+t.typeTexts[e.type]][0].id:""}else n[e.name]=t.form[e.name]}));var a="userCreate";t.form.id&&(a="userUpdate",n["id"]=t.form.id),a+=t.custom.name,t.$apollo.mutate({mutation:h()(Y(),a,t.custom.name,a,t.fieldNames.join(",")),variables:{data:n},fetchPolicy:"no-cache",context:{uri:m["a"].projectUri+u["a"].state.common.currentProject.id}}).then((function(){e.$emit("cancel")})).catch((function(t){e.$message.warning(Object(d["a"])(t.message))}))}))},getFieldList:function(){var e=this,t=this;t.$apollo.query({query:c["userFields"],variables:{more:{custom_id:t.custom.id}},fetchPolicy:"no-cache"}).then((function(e){var i=e.data.userFields.items,n=[],a=[],s={};t.formShow=!1;var o=t.dataForm;i.forEach((function(e){if(n.push(e),a.push(e.name),e.is_required){var i="请输入";"ASSET"!=e.type&&"REFERENCE"!=e.type||(i="请选择"),s[e.name]=[{type:"string",required:!0,message:i+e.zh_name,trigger:"blur"}]}if(o&&o.id&&("RICH_TEXT"==e.type&&(t.form[e.name]=""),t.form[e.name]=o[e.name],"ASSET"==e.type||"REFERENCE"==e.type)){var r=t.typeTexts[e.type],l=[];e.is_multiple?l=o[e.name+r]:o[e.name+r]&&(l=[o[e.name+r]]),t.form[e.name+r]=l}})),o&&o.id?t.form["id"]=o.id:t.form["id"]=void 0,t.rules=s,t.fields=n,t.fieldNames=a,t.formShow=!0})).catch((function(t){e.$message.warning(Object(d["a"])(t.message))}))},richValueChange:function(e){var t=e[0],i=e[1];this.form[i]=t},showAssetDialog:function(e){this.assetModal.item=e,this.assetModal.visible=!0},closeAssetDialog:function(){this.assetModal.visible=!1},assetSelectChange:function(e,t,i){this.selectChange("asset",e,t,i)},removeAsset:function(e,t){var i=[],n=[];this.form[t+"Asset"].forEach((function(t){t.id!=e.id&&(i.push(t),e.is_multiple?n.push(t.id):n=t.id)})),this.form[t+"Asset"]=i,this.form[t]=n},removeReference:function(e,t){var i=[],n=[];this.form[t+"Reference"].forEach((function(t){t.id!=e.id&&(i.push(t),e.is_multiple?n.push(t.id):n=t.id)})),this.form[t+"Reference"]=i,this.form[t]=n},showReferenceDialog:function(e){this.referenceModal.item=e,this.referenceModal.visible=!0},closeReferenceDialog:function(){this.referenceModal.visible=!1},selectChange:function(e,t,i,n){console.log(this.$refs.createForm);var a="";if(a="asset"==e?"Asset":"Reference",n){var s=!1;this.form[i+a]&&this.form[i+a].length>0&&this.form[i+a].forEach((function(e){e.id==t.id&&(s=!0)})),s||(this.form[i+a]&&this.form[i+a].length>0?this.form[i+a].push(t):this.form[i+a]=[t],n?this.form[i].push(t.id):this.form[i]=t.id),this.$refs.createForm.clearValidate()}else this.form[i+a]=[t],n?this.form[i].push(t.id):this.form[i]=t.id,this.$refs.createForm.clearValidate(),"asset"==e?this.closeAssetDialog():this.closeReferenceDialog()},referenceSelectChange:function(e,t,i){this.selectChange("reference",e,t,i)},formValueChange:function(){this.form=Object.assign({},this.form)}}},ee=Z,te=(i("1b22"),Object(C["a"])(ee,w,N,!1,null,"6373dd70",null)),ie=te.exports,ne=i("21b3"),ae={components:{UpdateContent:ie,Contents:_,BasePage:s["b"]},data:function(){return{content:{id:1},show_list:!1,selectedTags:[],customs:[],selectCustom:null,show_update:!1,show_models:!0,models_height:"0px",categories:[],openKeys:[]}},computed:{toggleDirection:function(){return this.show_models?"down":"right"}},mounted:function(){this.getCustomList()},methods:{getCustomList:function(){var e=this,t=this;t.$apollo.query({query:ne["userCategoryList"],variables:{},fetchPolicy:"no-cache"}).then((function(e){t.categories=e.data.userCategories.items;var i=[];t.categories.forEach((function(e){i.push(e.id)})),t.openKeys=i})).catch((function(t){e.$message.warning(Object(d["a"])(t.message))}))},menuClick:function(e){this.selectCustom=null,this.show_list=!1,this.show_update=!1;var t=this;setTimeout((function(){t.selectCustom=t.customs[e.key],t.show_list=!0}),100)},cancelUpdate:function(){this.show_update=!1,this.show_list=!0},update:function(e){this.show_list=!1,this.content=e?e||{}:void 0;var t=this;setTimeout((function(){t.show_update=!0}),100)}}},se=ae,oe=(i("2226"),Object(C["a"])(se,n,a,!1,null,"7e80fc4f",null));t["default"]=oe.exports},"581c":function(e,t,i){"use strict";var n=i("ac79"),a=i.n(n);a.a},"6f06":function(e,t,i){},"7320e":function(e,t,i){"use strict";var n=i("2366"),a=i.n(n);a.a},"830f":function(e,t,i){"use strict";var n=i("9dab"),a=i.n(n);a.a},"9dab":function(e,t,i){},a15b:function(e,t,i){"use strict";var n=i("23e7"),a=i("44ad"),s=i("fc6a"),o=i("a640"),r=[].join,l=a!=Object,c=o("join",",");n({target:"Array",proto:!0,forced:l||!c},{join:function(e){return r.call(s(this),void 0===e?",":e)}})},a54e:function(e,t,i){},ac79:function(e,t,i){},b7d2:function(e,t,i){},b999:function(e,t,i){},f79b:function(e,t,i){"use strict";var n=i("b7d2"),a=i.n(n);a.a}}]);